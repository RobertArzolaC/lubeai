{% extends "layouts/dashboard.html" %}
{% load static %}
{% load i18n %}
{% load breadcrumb_tags %}

{% block title_page%}
    {{ organization.name }}
{% endblock title_page %}

{% block toolbar_title %}
    {{ entity }}: {{ organization.name }}
{% endblock%}

{% block entity_options %}
<div class="d-flex align-items-center flex-nowrap text-nowrap py-1">
    {% if perms.users.change_organization %}
        <a href="{{ edit_url }}" class="btn btn-primary me-2">
            <i class="ki-duotone ki-pencil fs-2">
                <span class="path1"></span>
                <span class="path2"></span>
            </i>
            {% trans 'Edit' %}
        </a>
    {% endif %}
    {% if perms.users.delete_organization %}
        <button type="button" class="btn btn-danger delete-btn"
                data-url="{% url 'apps.users:organization_delete' organization.pk %}"
                data-name="{{ organization.name }}">
            <i class="ki-duotone ki-trash fs-2">
                <span class="path1"></span>
                <span class="path2"></span>
                <span class="path3"></span>
                <span class="path4"></span>
                <span class="path5"></span>
            </i>
            {% trans 'Delete' %}
        </button>
    {% endif %}
</div>
{% endblock %}

{% block content %}
<main class="container-xxl">
    <div class="row g-5 g-xl-8">
        <!-- General Information Card -->
        <div class="col-xl-6">
            <div class="card card-flush h-lg-100">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "General Information" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Name" %}</label>
                        <div class="col-lg-8">
                            <span class="fw-bold fs-6 text-gray-800">{{ organization.name }}</span>
                        </div>
                    </div>

                    {% if organization.description %}
                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Description" %}</label>
                        <div class="col-lg-8">
                            <span class="fw-semibold fs-6 text-gray-600">{{ organization.description }}</span>
                        </div>
                    </div>
                    {% endif %}

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Status" %}</label>
                        <div class="col-lg-8">
                            {% if organization.is_active %}
                                <span class="badge badge-light-success fs-7 fw-bold">{% trans "Active" %}</span>
                            {% else %}
                                <span class="badge badge-light-danger fs-7 fw-bold">{% trans "Inactive" %}</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Created" %}</label>
                        <div class="col-lg-8">
                            <span class="fw-semibold fs-6 text-gray-600">{{ organization.created|date:"M d, Y" }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Information Card -->
        <div class="col-xl-6">
            <div class="card card-flush h-lg-100">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "Contact Information" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    {% if organization.email %}
                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Email" %}</label>
                        <div class="col-lg-8">
                            <a href="mailto:{{ organization.email }}" class="fw-bold fs-6 text-gray-800 text-hover-primary">{{ organization.email }}</a>
                        </div>
                    </div>
                    {% endif %}

                    {% if organization.phone %}
                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Phone" %}</label>
                        <div class="col-lg-8">
                            <a href="tel:{{ organization.phone }}" class="fw-bold fs-6 text-gray-800 text-hover-primary">{{ organization.phone }}</a>
                        </div>
                    </div>
                    {% endif %}

                    {% if not organization.email and not organization.phone %}
                    <div class="text-center py-10">
                        <div class="text-gray-400">
                            <i class="ki-duotone ki-information-2 fs-2x mb-3">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                            </i>
                            <div class="fw-bold">{% trans "No contact information available" %}</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="row g-5 g-xl-8 mt-2">
        <!-- Address Information Card -->
        <div class="col-xl-12">
            <div class="card card-flush">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "Address Information" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    {% if organization.address or organization.city or organization.region or organization.country %}
                    <div class="row">
                        {% if organization.address %}
                        <div class="col-lg-6 mb-7">
                            <label class="fw-semibold text-muted mb-2">{% trans "Address" %}</label>
                            <div class="fw-bold fs-6 text-gray-800">{{ organization.address }}</div>
                        </div>
                        {% endif %}

                        {% if organization.city %}
                        <div class="col-lg-3 mb-7">
                            <label class="fw-semibold text-muted mb-2">{% trans "City" %}</label>
                            <div class="fw-bold fs-6 text-gray-800">{{ organization.city }}</div>
                        </div>
                        {% endif %}

                        {% if organization.district %}
                        <div class="col-lg-3 mb-7">
                            <label class="fw-semibold text-muted mb-2">{% trans "District" %}</label>
                            <div class="fw-bold fs-6 text-gray-800">{{ organization.district }}</div>
                        </div>
                        {% endif %}

                        {% if organization.region %}
                        <div class="col-lg-4 mb-7">
                            <label class="fw-semibold text-muted mb-2">{% trans "Region" %}</label>
                            <div class="fw-bold fs-6 text-gray-800">{{ organization.region }}</div>
                        </div>
                        {% endif %}

                        {% if organization.country %}
                        <div class="col-lg-4 mb-7">
                            <label class="fw-semibold text-muted mb-2">{% trans "Country" %}</label>
                            <div class="fw-bold fs-6 text-gray-800">{{ organization.country }}</div>
                        </div>
                        {% endif %}

                        {% if organization.zip_code %}
                        <div class="col-lg-4 mb-7">
                            <label class="fw-semibold text-muted mb-2">{% trans "Zip Code" %}</label>
                            <div class="fw-bold fs-6 text-gray-800">{{ organization.zip_code }}</div>
                        </div>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="text-center py-10">
                        <div class="text-gray-400">
                            <i class="ki-duotone ki-geolocation fs-2x mb-3">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            <div class="fw-bold">{% trans "No address information available" %}</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</main>

<!-- CSRF Token for AJAX requests -->
{% csrf_token %}

{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Handle delete button
    $('.delete-btn').click(function(e) {
        e.preventDefault();
        var url = $(this).data('url');
        var name = $(this).data('name');

        Swal.fire({
            title: '{% trans "Are you sure?" %}',
            text: '{% trans "You are about to delete" %} ' + name,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: '{% trans "Yes, delete it!" %}',
            cancelButtonText: '{% trans "Cancel" %}'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: url,
                    method: 'POST',
                    data: {
                        'csrfmiddlewaretoken': $('[name=csrfmiddlewaretoken]').val()
                    },
                    success: function(data) {
                        if (data.status === 'success') {
                            Swal.fire(
                                '{% trans "Deleted!" %}',
                                data.message,
                                'success'
                            ).then(() => {
                                window.location.href = '{% url "apps.users:organization_list" %}';
                            });
                        } else {
                            Swal.fire(
                                '{% trans "Error!" %}',
                                data.message,
                                'error'
                            );
                        }
                    },
                    error: function() {
                        Swal.fire(
                            '{% trans "Error!" %}',
                            '{% trans "Something went wrong. Please try again." %}',
                            'error'
                        );
                    }
                });
            }
        });
    });
});
</script>
{% endblock %}
