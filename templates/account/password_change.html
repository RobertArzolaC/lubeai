{% extends "layouts/home.html" %}
{% load static %}
{% load i18n allauth account %}
{% load widget_tweaks %}

{% block title_page %}
    {% trans "Change Password" %} - Industrial Dashboard
{% endblock %}

{% block content %}
<div class="lubricant-login-container d-flex flex-column flex-lg-row flex-column-fluid">
    <!-- Brand Side Panel -->
    <div class="lubricant-login-brand d-flex flex-column flex-lg-row-auto w-xl-600px position-xl-relative">
        <div class="d-flex flex-column position-xl-fixed top-0 bottom-0 w-xl-600px scroll-y">
            <!-- Industrial Pattern Background -->
            <div class="d-flex flex-row-fluid flex-column text-center p-5 p-lg-10 pt-lg-20">
                <!-- Logo Section -->
                <div class="py-2 py-lg-10 mb-4">
                    <img
                        alt="{{ config.PROJECT_NAME }} Logo"
                        src="{% static 'assets/images/logos/logo.png' %}"
                        class="lubricant-logo max-h-75px"
                        height="50"
                    />
                </div>

                <!-- Brand Title -->
                <h1 class="lubricant-brand-title d-none d-lg-block fs-2qx pb-5 pb-md-8">
                    <i class="fas fa-shield-alt lubricant-icon me-3 lubricant-pulse"></i>
                    {% trans "Security Settings" %}
                </h1>

                <!-- Brand Description -->
                <div class="d-none d-lg-block">
                    <p class="lubricant-brand-subtitle fs-2 mb-4">
                        <i class="fas fa-lock lubricant-icon me-2"></i>
                        {% trans "Protect your account with a strong password" %}
                    </p>
                    <p class="lubricant-brand-subtitle fs-4 opacity-75">
                        {% trans "Enhanced security • Password encryption • Account protection" %}
                    </p>
                </div>

                <!-- Mobile Brand -->
                <div class="d-lg-none text-center py-4">
                    <h2 class="lubricant-brand-title fs-1 mb-3">
                        {{ config.PROJECT_NAME }}
                    </h2>
                    <p class="lubricant-brand-subtitle fs-6">
                        {% trans "Industrial Dashboard Platform" %}
                    </p>
                </div>
            </div>

            <!-- Security Illustration -->
            <div class="d-none d-lg-block d-flex flex-row-auto justify-content-center align-items-end pb-10">
                <div class="text-center">
                    <i class="fas fa-user-shield lubricant-icon fa-5x opacity-50 mb-4"></i>
                    <div class="d-flex justify-content-center gap-3">
                        <i class="fas fa-key lubricant-icon fa-2x"></i>
                        <i class="fas fa-lock text-warning fa-2x"></i>
                        <i class="fas fa-shield-alt lubricant-icon fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Form Side -->
    <div class="d-flex flex-column flex-lg-row-fluid justify-content-center align-items-center py-10">
        <div class="w-100 w-lg-500px px-4 px-lg-0">
            <!-- Main Change Password Form -->
            <div class="lubricant-login-form">
                <!-- Form Header -->
                <div class="text-center mb-10">
                    <!-- Mobile Logo -->
                    <div class="d-lg-none mb-6">
                        <img alt="Logo" src="{% static 'assets/images/logos/logo.png' %}" class="lubricant-logo max-h-50px" height="35" />
                    </div>

                    <h1 class="text-lubricant-primary mb-4 fs-2x fw-bold">
                        <i class="fas fa-key lubricant-icon me-3"></i>
                        {% trans "Change Password" %}
                    </h1>
                    <p class="text-lubricant-secondary fs-6 fw-semibold mb-6">
                        {% trans "Update your account password to keep it secure" %}
                    </p>
                    <hr class="lubricant-divider">
                </div>

                <!-- Change Password Form -->
                <form class="form w-100" method="POST" action="{% url "account_change_password" %}">
                    {% csrf_token %}

                    <!-- Old Password Field -->
                    <div class="fv-row mb-7">
                        {{ form.oldpassword|add_label_class:"lubricant-form-label required" }}
                        <div class="position-relative">
                            <div class="input-group">
                                <span class="input-group-text bg-lubricant-surface border-end-0">
                                    <i class="fas fa-lock text-lubricant-secondary"></i>
                                </span>
                                {{ form.oldpassword|add_class:"lubricant-form-control border-start-0 ps-5"|attr:"autocomplete:current-password" }}
                                <span class="input-group-text bg-lubricant-surface border-start-0 cursor-pointer" onclick="togglePasswordVisibility('oldpassword', 'toggleOldPasswordIcon')">
                                    <i class="fas fa-eye text-lubricant-secondary" id="toggleOldPasswordIcon"></i>
                                </span>
                            </div>
                            {% if form.oldpassword.errors %}
                                <div class="lubricant-error mt-2">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    {{ form.oldpassword.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- New Password Field -->
                    <div class="fv-row mb-7">
                        {{ form.password1|add_label_class:"lubricant-form-label required" }}
                        <div class="position-relative">
                            <div class="input-group">
                                <span class="input-group-text bg-lubricant-surface border-end-0">
                                    <i class="fas fa-key text-lubricant-secondary"></i>
                                </span>
                                {{ form.password1|add_class:"lubricant-form-control border-start-0 ps-5"|attr:"autocomplete:new-password" }}
                                <span class="input-group-text bg-lubricant-surface border-start-0 cursor-pointer" onclick="togglePasswordVisibility('password1', 'togglePassword1Icon')">
                                    <i class="fas fa-eye text-lubricant-secondary" id="togglePassword1Icon"></i>
                                </span>
                            </div>
                            {% if form.password1.errors %}
                                <div class="lubricant-error mt-2">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    {{ form.password1.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Confirm New Password Field -->
                    <div class="fv-row mb-8">
                        {{ form.password2|add_label_class:"lubricant-form-label required" }}
                        <div class="position-relative">
                            <div class="input-group">
                                <span class="input-group-text bg-lubricant-surface border-end-0">
                                    <i class="fas fa-check-circle text-lubricant-secondary"></i>
                                </span>
                                {{ form.password2|add_class:"lubricant-form-control border-start-0 ps-5"|attr:"autocomplete:new-password" }}
                                <span class="input-group-text bg-lubricant-surface border-start-0 cursor-pointer" onclick="togglePasswordVisibility('password2', 'togglePassword2Icon')">
                                    <i class="fas fa-eye text-lubricant-secondary" id="togglePassword2Icon"></i>
                                </span>
                            </div>
                            {% if form.password2.errors %}
                                <div class="lubricant-error mt-2">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    {{ form.password2.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Password Requirements -->
                    <div class="text-muted mb-8">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-info-circle me-2 text-lubricant-secondary"></i>
                            <small class="fw-semibold">{% trans "Password Requirements:" %}</small>
                        </div>
                        <ul class="ps-4 mb-0">
                            <li><small>{% trans "At least 8 characters long" %}</small></li>
                            <li><small>{% trans "Include uppercase and lowercase letters" %}</small></li>
                            <li><small>{% trans "Include at least one number" %}</small></li>
                        </ul>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-grid mb-6">
                        <button type="submit" class="btn btn-lg btn-primary py-4">
                            <span class="indicator-label fs-5 fw-bold">
                                <i class="fas fa-save me-3"></i>
                                {% trans "Update Password" %}
                            </span>
                        </button>
                    </div>

                    <!-- Back to Settings Link -->
                    <div class="text-center mb-4">
                        <a href="{% url 'apps.users:settings' %}" class="lubricant-link fs-7 fw-semibold">
                            <i class="fas fa-arrow-left me-2"></i>
                            {% trans "Back to Settings" %}
                        </a>
                    </div>

                    <!-- Security Notice -->
                    <div class="text-center">
                        <small class="text-lubricant-medium d-flex align-items-center justify-content-center">
                            <i class="fas fa-shield-alt me-2"></i>
                            {% trans "Your password is encrypted and secure" %}
                        </small>
                    </div>
                </form>
            </div>

            <!-- Footer Information -->
            <div class="text-center mt-6">
                <p class="text-lubricant-medium fs-7">
                    <i class="fas fa-copyright me-1"></i>
                    {{ config.PROJECT_NAME }} - {% trans "Industrial Dashboard Platform" %}
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Password Toggle Script -->
<script>
function togglePasswordVisibility(fieldName, iconId) {
    const passwordInput = document.querySelector(`input[name="${fieldName}"]`);
    const toggleIcon = document.getElementById(iconId);

    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash');
    } else {
        passwordInput.type = 'password';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye');
    }
}

// Add loading animation on form submit
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const submitBtn = document.querySelector('button[type="submit"]');

    form.addEventListener('submit', function() {
        submitBtn.classList.add('lubricant-loading');
        submitBtn.innerHTML = '<i class="fas fa-cog fa-spin me-2"></i>{% trans "Updating..." %}';
        submitBtn.disabled = true;
    });
});
</script>
{% endblock content %}
