{% extends "layouts/dashboard.html" %}
{% load static %}
{% load i18n %}
{% load breadcrumb_tags %}

{% block title_page%}
    {{ report.lab_number }}
{% endblock title_page %}

{% block toolbar_title %}
    {{ entity }}: {{ report.lab_number }}
{% endblock%}

{% block entity_options %}
<div class="d-flex align-items-center flex-nowrap text-nowrap py-1">
    {% if perms.reports.change_report %}
        <a href="{{ edit_url }}" class="btn btn-primary me-2">
            <i class="ki-duotone ki-pencil fs-2">
                <span class="path1"></span>
                <span class="path2"></span>
            </i>
            {% trans 'Edit' %}
        </a>
    {% endif %}
    {% if perms.reports.delete_report %}
        <button type="button" class="btn btn-danger delete-btn"
                data-url="{% url 'apps.reports:report_delete' report.pk %}"
                data-name="{{ report.lab_number }}">
            <i class="ki-duotone ki-trash fs-2">
                <span class="path1"></span>
                <span class="path2"></span>
                <span class="path3"></span>
                <span class="path4"></span>
                <span class="path5"></span>
            </i>
            {% trans 'Delete' %}
        </button>
    {% endif %}
</div>
{% endblock %}

{% block content %}
<main class="container-xxl">
    <div class="row g-5 g-xl-8">
        <!-- General Information Card -->
        <div class="col-xl-6">
            <div class="card card-flush h-lg-100">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "General Information" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Lab Number" %}</label>
                        <div class="col-lg-8">
                            <span class="fw-bold fs-6 text-gray-800">{{ report.lab_number }}</span>
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "PER Number" %}</label>
                        <div class="col-lg-8">
                            {% if report.per_number %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.per_number }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Serial Number Code" %}</label>
                        <div class="col-lg-8">
                            {% if report.serial_number_code %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.serial_number_code }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Status" %}</label>
                        <div class="col-lg-8">
                            {% if report.status == 'PENDING' %}
                                <span class="badge badge-warning fs-7 fw-bold">{{ report.get_status_display }}</span>
                            {% elif report.status == 'REVIEWED' %}
                                <span class="badge badge-info fs-7 fw-bold">{{ report.get_status_display }}</span>
                            {% elif report.status == 'APPROVED' %}
                                <span class="badge badge-success fs-7 fw-bold">{{ report.get_status_display }}</span>
                            {% elif report.status == 'REJECTED' %}
                                <span class="badge badge-danger fs-7 fw-bold">{{ report.get_status_display }}</span>
                            {% else %}
                                <span class="badge badge-secondary fs-7 fw-bold">{{ report.get_status_display }}</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Condition" %}</label>
                        <div class="col-lg-8">
                            {% if report.condition == 'NORMAL' %}
                                <span class="badge badge-success fs-7 fw-bold">{{ report.get_condition_display }}</span>
                            {% elif report.condition == 'CAUTION' %}
                                <span class="badge badge-warning fs-7 fw-bold">{{ report.get_condition_display }}</span>
                            {% elif report.condition == 'CRITICAL' %}
                                <span class="badge badge-danger fs-7 fw-bold">{{ report.get_condition_display }}</span>
                            {% elif report.condition == 'SEVERE' %}
                                <span class="badge badge-dark fs-7 fw-bold">{{ report.get_condition_display }}</span>
                            {% else %}
                                <span class="badge badge-secondary fs-7 fw-bold">{{ report.get_condition_display }}</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Filter Change" %}</label>
                        <div class="col-lg-8">
                            {% if report.filter_change %}
                                <span class="badge badge-light-info fs-7 fw-bold">{{ report.filter_change }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Oil Change" %}</label>
                        <div class="col-lg-8">
                            {% if report.oil_change %}
                                <span class="badge badge-light-info fs-7 fw-bold">{{ report.oil_change }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Active" %}</label>
                        <div class="col-lg-8">
                            {% if report.is_active %}
                                <span class="badge badge-light-success fs-7 fw-bold">{% trans "Active" %}</span>
                            {% else %}
                                <span class="badge badge-light-danger fs-7 fw-bold">{% trans "Inactive" %}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Equipment & Component Card -->
        <div class="col-xl-6">
            <div class="card card-flush h-lg-100">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "Equipment & Component" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Organization" %}</label>
                        <div class="col-lg-8">
                            {% if report.organization %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.organization.name }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Machine" %}</label>
                        <div class="col-lg-8">
                            {% if report.machine %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.machine.name }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Component" %}</label>
                        <div class="col-lg-8">
                            {% if report.component %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.component_name }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Machine Hours" %}</label>
                        <div class="col-lg-8">
                            {% if report.machine_hours %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.machine_hours }} {% trans "hrs" %}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Machine Kilometers" %}</label>
                        <div class="col-lg-8">
                            {% if report.machine_kms %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.machine_kms }} {% trans "km" %}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lubricant Information Card -->
        <div class="col-xl-6">
            <div class="card card-flush h-lg-100">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "Lubricant Information" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Lubricant" %}</label>
                        <div class="col-lg-8">
                            {% if report.lubricant %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.lubricant }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Lubricant Hours" %}</label>
                        <div class="col-lg-8">
                            {% if report.lubricant_hours %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.lubricant_hours }} {% trans "hrs" %}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Lubricant Kilometers" %}</label>
                        <div class="col-lg-8">
                            {% if report.lubricant_kms %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.lubricant_kms }} {% trans "km" %}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Important Dates Card -->
        <div class="col-xl-6">
            <div class="card card-flush h-lg-100">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "Important Dates" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Sample Date" %}</label>
                        <div class="col-lg-8">
                            {% if report.sample_date %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.sample_date|date:"M d, Y" }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Reception Date" %}</label>
                        <div class="col-lg-8">
                            {% if report.reception_date %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.reception_date|date:"M d, Y" }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Report Date" %}</label>
                        <div class="col-lg-8">
                            {% if report.report_date %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.report_date|date:"M d, Y" }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Created" %}</label>
                        <div class="col-lg-8">
                            <span class="fw-semibold fs-6 text-gray-600">{{ report.created|date:"M d, Y H:i" }}</span>
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Last Updated" %}</label>
                        <div class="col-lg-8">
                            <span class="fw-semibold fs-6 text-gray-600">{{ report.modified|date:"M d, Y H:i" }}</span>
                        </div>
                    </div>

                    {% if report.created_by %}
                    <div class="row mb-7">
                        <label class="col-lg-4 fw-semibold text-muted">{% trans "Created By" %}</label>
                        <div class="col-lg-8">
                            <span class="fw-semibold fs-6 text-gray-600">{{ report.created_by.get_full_name|default:report.created_by.username }}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Notes & Others Card -->
        <div class="col-xl-12">
            <div class="card card-flush">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "Notes & Additional Information" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    <div class="row mb-7">
                        <label class="col-lg-2 fw-semibold text-muted">{% trans "Notes" %}</label>
                        <div class="col-lg-10">
                            {% if report.notes %}
                                <div class="text-gray-800">
                                    {{ report.notes|linebreaks }}
                                </div>
                            {% else %}
                                <div class="text-muted">{% trans "No notes available" %}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-2 fw-semibold text-muted">{% trans "Others" %}</label>
                        <div class="col-lg-10">
                            {% if report.others %}
                                <div class="text-gray-800">
                                    {{ report.others|linebreaks }}
                                </div>
                            {% else %}
                                <div class="text-muted">{% trans "No additional information" %}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% if report.analysis %}
        <!-- Laboratory Analysis Summary -->
        <div class="col-xl-12">
            <div class="card card-flush bg-light-primary">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800 fs-2">
                            <i class="ki-duotone ki-flask fs-2 me-2">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            {% trans "Laboratory Analysis Summary" %}
                        </span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    <div class="row g-5">
                        <!-- Total Wear Metals -->
                        <div class="col-md-4">
                            <div class="d-flex flex-column">
                                <span class="fs-7 text-muted mb-2">{% trans "Total Wear Metals" %}</span>
                                <div class="d-flex align-items-center">
                                    <span class="fs-2x fw-bold text-gray-800 me-3">{{ report.analysis.total_wear_metals }}</span>
                                    <span class="text-muted">ppm</span>
                                    {% if report.analysis.total_wear_metals > 500 %}
                                        <span class="badge badge-danger ms-3">{% trans "Critical" %}</span>
                                    {% elif report.analysis.total_wear_metals > 200 %}
                                        <span class="badge badge-warning ms-3">{% trans "Caution" %}</span>
                                    {% else %}
                                        <span class="badge badge-success ms-3">{% trans "Normal" %}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Total Contaminants -->
                        <div class="col-md-4">
                            <div class="d-flex flex-column">
                                <span class="fs-7 text-muted mb-2">{% trans "Total Contaminants" %}</span>
                                <div class="d-flex align-items-center">
                                    <span class="fs-2x fw-bold text-gray-800 me-3">{{ report.analysis.total_contaminants }}</span>
                                    <span class="text-muted">ppm</span>
                                    {% if report.analysis.total_contaminants > 100 %}
                                        <span class="badge badge-danger ms-3">{% trans "Critical" %}</span>
                                    {% elif report.analysis.total_contaminants > 50 %}
                                        <span class="badge badge-warning ms-3">{% trans "Caution" %}</span>
                                    {% else %}
                                        <span class="badge badge-success ms-3">{% trans "Normal" %}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Additive Depletion -->
                        <div class="col-md-4">
                            <div class="d-flex flex-column">
                                <span class="fs-7 text-muted mb-2">{% trans "Additive Depletion" %}</span>
                                <div class="d-flex align-items-center">
                                    <span class="fs-2x fw-bold text-gray-800 me-3">{{ report.analysis.additive_depletion_pct|floatformat:1 }}</span>
                                    <span class="text-muted">%</span>
                                    {% if report.analysis.additive_depletion_pct > 50 %}
                                        <span class="badge badge-danger ms-3">{% trans "Critical" %}</span>
                                    {% elif report.analysis.additive_depletion_pct > 25 %}
                                        <span class="badge badge-warning ms-3">{% trans "Caution" %}</span>
                                    {% else %}
                                        <span class="badge badge-success ms-3">{% trans "Normal" %}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Water Tests & Viscosity -->
        <div class="col-xl-6">
            <div class="card card-flush h-lg-100">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "Water Tests & Viscosity" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Water Crackle Test" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.water_crackle %}
                                {% if report.analysis.water_crackle == 'POSITIVE' %}
                                    <span class="badge badge-danger">{{ report.analysis.water_crackle }}</span>
                                {% else %}
                                    <span class="badge badge-success">{{ report.analysis.water_crackle }}</span>
                                {% endif %}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Water Distillation" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.water_distillation %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.water_distillation }}%</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Viscosity @ 40°C" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.viscosity_40c %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.viscosity_40c }} cSt</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Viscosity @ 100°C" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.viscosity_100c %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.viscosity_100c }} cSt</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Compatibility" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.compatibility %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.compatibility }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "TBN (Total Base Number)" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.tbn %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.tbn }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "TAN (Total Acid Number)" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.tan %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.tan }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FTIR Analysis & Particles -->
        <div class="col-xl-6">
            <div class="card card-flush h-lg-100">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "FTIR Analysis & Particles" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Oxidation" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.oxidation %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.oxidation }} Abs/cm</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Soot" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.soot %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.soot }}%</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Nitration" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.nitration %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.nitration }} Abs/cm</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Sulfation" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.sulfation %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.sulfation }} Abs/cm</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Glycol" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.glycol %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.glycol }}%</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Fuel Dilution" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.fuel_dilution %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.fuel_dilution }}%</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Water (FTIR)" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.water_ftir %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.water_ftir }}%</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "PQ Index" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.pq_index %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.pq_index }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-7">
                        <label class="col-lg-6 fw-semibold text-muted">{% trans "Particle Count ISO 4406" %}</label>
                        <div class="col-lg-6">
                            {% if report.analysis.particle_count_iso %}
                                <span class="fw-bold fs-6 text-gray-800">{{ report.analysis.particle_count_iso }}</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Wear Metals -->
        <div class="col-xl-6">
            <div class="card card-flush h-lg-100">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "Wear Metals (ppm)" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    <div class="table-responsive">
                        <table class="table table-row-bordered table-row-gray-300 align-middle gs-0 gy-3">
                            <tbody>
                                <tr>
                                    <td class="fw-semibold text-muted">{% trans "Iron (Fe)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.iron_fe|default:"-" }}</td>
                                    <td class="fw-semibold text-muted">{% trans "Chromium (Cr)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.chromium_cr|default:"-" }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-semibold text-muted">{% trans "Lead (Pb)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.lead_pb|default:"-" }}</td>
                                    <td class="fw-semibold text-muted">{% trans "Copper (Cu)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.copper_cu|default:"-" }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-semibold text-muted">{% trans "Tin (Sn)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.tin_sn|default:"-" }}</td>
                                    <td class="fw-semibold text-muted">{% trans "Aluminum (Al)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.aluminum_al|default:"-" }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-semibold text-muted">{% trans "Nickel (Ni)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.nickel_ni|default:"-" }}</td>
                                    <td class="fw-semibold text-muted">{% trans "Silver (Ag)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.silver_ag|default:"-" }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contaminants -->
        <div class="col-xl-6">
            <div class="card card-flush h-lg-100">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "Contaminants (ppm)" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    <div class="table-responsive">
                        <table class="table table-row-bordered table-row-gray-300 align-middle gs-0 gy-3">
                            <tbody>
                                <tr>
                                    <td class="fw-semibold text-muted">{% trans "Silicon (Si)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.silicon_si|default:"-" }}</td>
                                    <td class="fw-semibold text-muted">{% trans "Boron (B)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.boron_b|default:"-" }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-semibold text-muted">{% trans "Sodium (Na)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.sodium_na|default:"-" }}</td>
                                    <td class="fw-semibold text-muted">{% trans "Magnesium (Mg)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.magnesium_mg|default:"-" }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-semibold text-muted">{% trans "Potassium (K)" %}</td>
                                    <td class="text-end fw-bold" colspan="3">{{ report.analysis.potassium_k|default:"-" }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additives -->
        <div class="col-xl-12">
            <div class="card card-flush">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "Additives (ppm)" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    <div class="table-responsive">
                        <table class="table table-row-bordered table-row-gray-300 align-middle gs-0 gy-3">
                            <tbody>
                                <tr>
                                    <td class="fw-semibold text-muted">{% trans "Molybdenum (Mo)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.molybdenum_mo|default:"-" }}</td>
                                    <td class="fw-semibold text-muted">{% trans "Titanium (Ti)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.titanium_ti|default:"-" }}</td>
                                    <td class="fw-semibold text-muted">{% trans "Vanadium (V)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.vanadium_v|default:"-" }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-semibold text-muted">{% trans "Manganese (Mn)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.manganese_mn|default:"-" }}</td>
                                    <td class="fw-semibold text-muted">{% trans "Phosphorus (P)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.phosphorus_p|default:"-" }}</td>
                                    <td class="fw-semibold text-muted">{% trans "Zinc (Zn)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.zinc_zn|default:"-" }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-semibold text-muted">{% trans "Calcium (Ca)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.calcium_ca|default:"-" }}</td>
                                    <td class="fw-semibold text-muted">{% trans "Barium (Ba)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.barium_ba|default:"-" }}</td>
                                    <td class="fw-semibold text-muted">{% trans "Cadmium (Cd)" %}</td>
                                    <td class="text-end fw-bold">{{ report.analysis.cadmium_cd|default:"-" }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Visual Appearance -->
        <div class="col-xl-12">
            <div class="card card-flush">
                <div class="card-header pt-7">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bold text-gray-800">{% trans "Visual Appearance" %}</span>
                    </h3>
                </div>
                <div class="card-body pt-6">
                    {% if report.analysis.visual_appearance %}
                        <div class="text-gray-800">
                            {{ report.analysis.visual_appearance }}
                        </div>
                    {% else %}
                        <div class="text-muted">{% trans "No visual appearance data available" %}</div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% else %}
            <!-- No Laboratory Analysis Available -->
            <div class="col-xl-12">
                <div class="card card-flush bg-light-warning">
                    <div class="card-body text-center py-10">
                        <i class="ki-duotone ki-information-3 fs-3x text-warning mb-5">
                            <span class="path1"></span>
                            <span class="path2"></span>
                            <span class="path3"></span>
                        </i>
                        <h3 class="text-gray-800 fw-bold mb-2">{% trans "No Laboratory Analysis Available" %}</h3>
                        <p class="text-muted">{% trans "Laboratory analysis data has not been added to this report yet." %}</p>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</main>
{% endblock %}

{% block scripts %}
<script>
    // Delete functionality
    document.querySelector('.delete-btn')?.addEventListener('click', function() {
        const url = this.dataset.url;
        const name = this.dataset.name;

        if (confirm(`{% trans "Are you sure you want to delete report" %} ${name}?`)) {
            fetch(url, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || '',
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    window.location.href = "{% url 'apps.reports:report_list' %}";
                } else {
                    alert(data.message || 'Error deleting report');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error deleting report');
            });
        }
    });
</script>
{% endblock %}
